# 缺失模块清单 ⭐

**生成时间**: 2025-11-21
**总计缺失**: 22 个模块
**总代码行数**: ~3,547 行

---

## 📊 按重要性分类

### 🔴 **核心功能（必须实现）**

#### 1. `tools/file/` 文件操作工具 (1,026 行)

| 文件 | 行数 | 功能 | 优先级 |
|------|------|------|--------|
| `grep.py` | 302 | 内容搜索（ripgrep） | ⭐⭐⭐ 最高 |
| `glob.py` | 148 | 文件模式匹配搜索 | ⭐⭐⭐ 最高 |
| `read.py` | 140 | 读取文件 | ⭐⭐⭐ 最高 |
| `write.py` | 119 | 写入文件 | ⭐⭐⭐ 最高 |
| `patch.py` | 173 | 补丁式编辑 | ⭐⭐ 高 |
| `replace.py` | 144 | 内容替换 | ⭐⭐ 高 |

**说明**: 这是 **最核心** 的工具集，AI Agent 的大部分文件操作都依赖这些工具。

**影响**:
- ❌ 当前 Agent 无法执行文件搜索、读写操作
- ❌ 无法完整体验 Kimi CLI 的核心功能

---

#### 2. `tools/task/__init__.py` (185 行)

**功能**: 子任务代理系统（Task Agent）

**说明**: 支持启动子 Agent 处理复杂任务，实现递归 Agent 调用。

**影响**:
- ❌ 无法使用 `/task` 命令
- ❌ 无法执行复杂的多步骤任务分解

**优先级**: ⭐⭐ 高

---

### 🟡 **重要功能（建议实现）**

#### 3. `ui/wire/` Wire 协议（393 行）

| 文件 | 行数 | 功能 |
|------|------|------|
| `__init__.py` | 342 | ACP/MCP 协议通信 |
| `jsonrpc.py` | 51 | JSON-RPC 2.0 实现 |

**说明**: IDE 插件集成的核心协议层。

**影响**:
- ❌ 无法与 VS Code/JetBrains 插件通信
- ❌ 无法支持远程 Agent 模式

**优先级**: ⭐⭐ 高（如果需要 IDE 集成）

---

#### 4. `ui/shell/` Shell UI 增强功能（692 行）

| 文件 | 行数 | 功能 |
|------|------|------|
| `update.py` | 212 | 版本更新检查 |
| `debug.py` | 189 | 调试模式（显示内部状态） |
| `keyboard.py` | 185 | 键盘快捷键绑定 |
| `replay.py` | 106 | 会话回放功能 |

**影响**:
- ⚠️ 无法检查版本更新
- ⚠️ 无法使用调试模式
- ⚠️ 无法使用键盘快捷键（如 Ctrl+C）
- ⚠️ 无法回放历史会话

**优先级**: ⭐ 中（增强功能，非核心）

---

### 🟢 **辅助功能（可选实现）**

#### 5. `utils/rich/` Rich 渲染增强（1,058 行）

| 文件 | 行数 | 功能 |
|------|------|------|
| `markdown.py` | 959 | Markdown 富文本渲染 |
| `columns.py` | 99 | 列布局显示 |

**说明**: 提升终端显示效果。

**影响**:
- ⚠️ Markdown 显示效果较差
- ⚠️ 无法使用多列布局

**优先级**: ⭐ 中（体验优化）

---

#### 6. `tools/test.py` (55 行)

**功能**: 测试工具（用于开发调试）

**优先级**: 低

---

#### 7. `utils/` 其他工具函数（338 行）

| 文件 | 行数 | 功能 |
|------|------|------|
| `term.py` | 116 | 终端控制 |
| `changelog.py` | 107 | 更新日志解析 |
| `signals.py` | 43 | 信号处理 |
| `pyinstaller.py` | 26 | PyInstaller 打包支持 |
| `message.py` | 24 | 消息工具 |
| `string.py` | 22 | 字符串工具 |

**优先级**: 低

---

## 📈 实现优先级建议

### Stage 27: 文件工具集成 🔴 **最高优先级**
**预估代码**: ~1,026 行
**预估时间**: 4-6 小时

**实现清单**:
1. ✅ `tools/file/read.py` - 读取文件
2. ✅ `tools/file/write.py` - 写入文件
3. ✅ `tools/file/glob.py` - 文件搜索
4. ✅ `tools/file/grep.py` - 内容搜索
5. ✅ `tools/file/replace.py` - 内容替换
6. ✅ `tools/file/patch.py` - 补丁编辑

**成果**: Agent 可以执行完整的文件操作

---

### Stage 28: Task Agent 系统 🟡 高优先级
**预估代码**: ~185 行
**预估时间**: 2-3 小时

**实现清单**:
1. ✅ `tools/task/__init__.py` - 子任务代理

**成果**: 支持复杂任务分解和子 Agent 调用

---

### Stage 29: Wire 协议集成 🟡 高优先级（可选）
**预估代码**: ~393 行
**预估时间**: 3-4 小时

**实现清单**:
1. ✅ `ui/wire/__init__.py` - ACP/MCP 协议
2. ✅ `ui/wire/jsonrpc.py` - JSON-RPC

**成果**: 支持 IDE 插件集成

---

### Stage 30: UI 增强功能 🟢 中优先级
**预估代码**: ~692 行
**预估时间**: 4-5 小时

**实现清单**:
1. ⚪ `ui/shell/keyboard.py` - 键盘快捷键
2. ⚪ `ui/shell/debug.py` - 调试模式
3. ⚪ `ui/shell/update.py` - 版本更新
4. ⚪ `ui/shell/replay.py` - 会话回放

---

### Stage 31: 辅助功能 🟢 低优先级
**预估代码**: ~1,396 行
**预估时间**: 6-8 小时

**实现清单**:
- utils/rich/markdown.py
- utils/rich/columns.py
- utils/ 其他工具函数

---

## 🎯 当前状态评估

| 功能模块 | 完成度 | 说明 |
|---------|--------|------|
| CLI 层 | 95% | ✅ 参数解析完整 |
| App 层 | 95% | ✅ 核心流程完整 |
| Soul 层 | 90% | ✅ KimiSoul、Approval、Runtime 完整 |
| **Tools 层** | **60%** | ❌ **缺失文件工具集** |
| UI 层 | 80% | ⚠️ 缺失部分增强功能 |
| Utils 层 | 75% | ⚠️ 缺失部分工具函数 |
| **整体** | **82%** | **核心架构完整，缺失文件操作** |

---

## 🚀 下一步行动

### 立即行动：Stage 27 文件工具集成
- **目标**: 实现 `tools/file/` 6 个文件操作工具
- **成果**: Agent 具备完整的文件读写搜索能力
- **时间**: 4-6 小时

**完成后整体进度**: ~82% → **95%** 🎉

---

**老王建议**: 先把 Stage 27 干完，文件工具是核心中的核心！没有它，Agent 就是个废物！💪
