# Stage 01ï¼šCLIå…¥å£æ¶æ„å¡«å……æµç¨‹

> æœ¬æ–‡æ¡£å±•ç¤º Stage 01 å¦‚ä½•ä»é›¶å¼€å§‹æ„å»º CLI å…¥å£ï¼Œä»¥åŠå„ä¸ªæ¨¡å—æ˜¯å¦‚ä½•é€æ­¥å¡«å……åŠŸèƒ½çš„ã€‚
>
> **é…åˆé˜…è¯»**ï¼š`docs/stage-01-cli-entry.md`ï¼ˆè¯¦ç»†çš„ä»£ç è®²è§£ï¼‰

---

## ğŸ“‹ ç›®å½•

1. [æ•´ä½“æ¶æ„æ¦‚è§ˆ](#æ•´ä½“æ¶æ„æ¦‚è§ˆ)
2. [é˜¶æ®µ0ï¼šç©ºç™½é¡¹ç›®](#é˜¶æ®µ0ç©ºç™½é¡¹ç›®)
3. [é˜¶æ®µ1ï¼šCLIå…¥å£éª¨æ¶](#é˜¶æ®µ1cliå…¥å£éª¨æ¶)
4. [æ¨¡å—å¡«å……é¡ºåº](#æ¨¡å—å¡«å……é¡ºåº)
5. [æ•°æ®æµå›¾](#æ•°æ®æµå›¾)
6. [ä¸‹ä¸€æ­¥é¢„å‘Š](#ä¸‹ä¸€æ­¥é¢„å‘Š)

---

## æ•´ä½“æ¶æ„æ¦‚è§ˆ

**My CLI çš„ä¸‰å±‚æ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CLI å±‚ï¼ˆcli.pyï¼‰                    â”‚
â”‚  â€¢ Click è£…é¥°å™¨å®šä¹‰å‘½ä»¤                                â”‚
â”‚  â€¢ å‚æ•°è§£æå’ŒéªŒè¯                                      â”‚
â”‚  â€¢ åŒæ­¥å…¥å£ â†’ å¼‚æ­¥æ¡¥æ¥                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ asyncio.run(async_main())
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  App å±‚ï¼ˆapp.pyï¼‰                     â”‚
â”‚  â€¢ åº”ç”¨é€»è¾‘åè°ƒ                                       â”‚
â”‚  â€¢ é…ç½®ç®¡ç†                                          â”‚
â”‚  â€¢ UI æ¨¡å¼è·¯ç”±                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ await app.run_xxx_mode()
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Soul å±‚ï¼ˆsoul.pyï¼‰                    â”‚
â”‚  â€¢ LLM API è°ƒç”¨                                      â”‚
â”‚  â€¢ å·¥å…·è°ƒç”¨æ‰§è¡Œ                                       â”‚
â”‚  â€¢ æ¶ˆæ¯å†å²ç®¡ç†                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                          â”‚
         â”‚ è°ƒç”¨å·¥å…·                  â”‚ è°ƒç”¨ UI
         â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Toolsï¼ˆå·¥å…·å±‚ï¼‰  â”‚      â”‚   UIï¼ˆç•Œé¢å±‚ï¼‰     â”‚
â”‚  â€¢ shell.py      â”‚      â”‚  â€¢ print_ui.py   â”‚
â”‚  â€¢ read_file.py  â”‚      â”‚  â€¢ shell_ui.py   â”‚
â”‚  â€¢ write_file.py â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é˜¶æ®µåˆ’åˆ†**ï¼š

| é˜¶æ®µ | å®Œæˆçš„å±‚ | æè¿° |
|------|---------|------|
| **Stage 0** | æ—  | ç©ºç™½é¡¹ç›®ï¼ˆåªæœ‰pyproject.tomlå’Œç©ºcli.pyï¼‰ |
| **Stage 1** | CLIå±‚ âœ… | å®ŒæˆCLIå…¥å£ï¼Œèƒ½æ¥æ”¶å‚æ•° |
| **Stage 2** | Appå±‚ ğŸš§ | å®ç°åº”ç”¨å±‚åè°ƒé€»è¾‘ |
| **Stage 3** | UIå±‚ ğŸš§ | å®ç°Print UIæ¨¡å¼ |
| **Stage 4** | Soulå±‚ ğŸš§ | å®ç°LLMè°ƒç”¨å’Œå·¥å…·æ‰§è¡Œ |
| **Stage 5+** | Toolså±‚ ğŸš§ | æ·»åŠ å„ç§å·¥å…· |

---

## é˜¶æ®µ0ï¼šç©ºç™½é¡¹ç›®

### æ–‡ä»¶ç»“æ„ï¼ˆinit commit: 8b827e5ï¼‰

```
my_cli/
â”œâ”€â”€ pyproject.toml        # é¡¹ç›®é…ç½®
â”œâ”€â”€ setup.py              # å®‰è£…è„šæœ¬
â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ .gitignore           # Gitå¿½ç•¥è§„åˆ™
â””â”€â”€ my_cli/
    â”œâ”€â”€ __init__.py      # ç©ºæ–‡ä»¶
    â””â”€â”€ cli.py           # åªæœ‰ä¸€ä¸ªprint()
```

### cli.pyï¼ˆæœ€åˆç‰ˆæœ¬ï¼‰

```python
def main():
    print("Hello, My CLI!")

if __name__ == "__main__":
    main()
```

**ç‰¹ç‚¹**ï¼š
- âŒ æ²¡æœ‰å‚æ•°è§£æ
- âŒ æ²¡æœ‰Clickæ¡†æ¶
- âŒ æ²¡æœ‰å¼‚æ­¥æ”¯æŒ
- âœ… èƒ½è¿è¡Œï¼š`python cli.py` â†’ è¾“å‡º "Hello, My CLI!"

---

## é˜¶æ®µ1ï¼šCLIå…¥å£éª¨æ¶

### ç›®æ ‡

å®ŒæˆCLIå±‚çš„æ­å»ºï¼Œè®©ç¨‹åºèƒ½å¤Ÿï¼š
1. âœ… æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°
2. âœ… éªŒè¯å‚æ•°ç±»å‹
3. âœ… ä½¿ç”¨å¼‚æ­¥å…¥å£
4. âœ… æ‰“å°åŸºæœ¬ä¿¡æ¯

### æ–‡ä»¶ç»“æ„ï¼ˆå½“å‰é˜¶æ®µï¼‰

```
my_cli/
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ setup.py
â”œâ”€â”€ README.md
â”œâ”€â”€ .gitignore
â””â”€â”€ my_cli/
    â”œâ”€â”€ __init__.py       # å¯¼å‡ºç‰ˆæœ¬å·
    â””â”€â”€ cli.py            # â­ CLIå…¥å£ï¼ˆæœ¬é˜¶æ®µæ ¸å¿ƒï¼‰
```

### æ¶æ„å¡«å……æ­¥éª¤

#### æ­¥éª¤1ï¼šå¼•å…¥Clickæ¡†æ¶

**ä¿®æ”¹å‰**ï¼š
```python
def main():
    print("Hello, My CLI!")
```

**ä¿®æ”¹å**ï¼š
```python
import click

@click.command()
def my_cli():
    """My CLI - AIåŠ©æ‰‹å‘½ä»¤è¡Œå·¥å…·"""
    print("Hello, My CLI!")
```

**æ”¹è¿›**ï¼š
- âœ… ä½¿ç”¨Clickè£…é¥°å™¨
- âœ… è‡ªåŠ¨ç”Ÿæˆ `--help`
- âœ… è‡ªåŠ¨ç”Ÿæˆå¸®åŠ©ä¿¡æ¯

---

#### æ­¥éª¤2ï¼šæ·»åŠ ç‰ˆæœ¬å·

**åœ¨ `my_cli/__init__.py` ä¸­**ï¼š
```python
__version__ = "0.1.0"
```

**åœ¨ `cli.py` ä¸­**ï¼š
```python
import click
from my_cli import __version__

@click.command()
@click.version_option(__version__)  # â­ æ·»åŠ ç‰ˆæœ¬é€‰é¡¹
def my_cli():
    """My CLI - AIåŠ©æ‰‹å‘½ä»¤è¡Œå·¥å…·"""
    print("Hello, My CLI!")
```

**æ”¹è¿›**ï¼š
- âœ… æ”¯æŒ `--version`
- âœ… ç‰ˆæœ¬å·ç»Ÿä¸€ç®¡ç†

---

#### æ­¥éª¤3ï¼šæ·»åŠ åŸºæœ¬å‚æ•°

**æ·»åŠ  --verbose å‚æ•°**ï¼š
```python
@click.command()
@click.version_option(__version__)
@click.option(
    "--verbose",
    is_flag=True,
    default=False,
    help="æ‰“å°è¯¦ç»†ä¿¡æ¯ã€‚é»˜è®¤ï¼šå¦",
)
def my_cli(verbose: bool):
    """My CLI - AIåŠ©æ‰‹å‘½ä»¤è¡Œå·¥å…·"""
    if verbose:
        print(f"[è¯¦ç»†] ç‰ˆæœ¬: {__version__}")
    print("Hello, My CLI!")
```

**æ”¹è¿›**ï¼š
- âœ… æ”¯æŒ `--verbose` æ ‡å¿—
- âœ… æ ¹æ®å‚æ•°æ§åˆ¶è¾“å‡º

---

#### æ­¥éª¤4ï¼šæ·»åŠ å·¥ä½œç›®å½•å‚æ•°

```python
from pathlib import Path

@click.command()
@click.version_option(__version__)
@click.option("--verbose", is_flag=True, default=False, help="...")
@click.option(
    "--work-dir",
    "-w",
    type=click.Path(exists=True, file_okay=False, dir_okay=True, path_type=Path),
    default=Path.cwd(),
    help="å·¥ä½œç›®å½•ã€‚é»˜è®¤ï¼šå½“å‰ç›®å½•",
)
def my_cli(verbose: bool, work_dir: Path):
    """My CLI - AIåŠ©æ‰‹å‘½ä»¤è¡Œå·¥å…·"""
    if verbose:
        print(f"[è¯¦ç»†] ç‰ˆæœ¬: {__version__}")
        print(f"[è¯¦ç»†] å·¥ä½œç›®å½•: {work_dir}")
    print("Hello, My CLI!")
```

**æ”¹è¿›**ï¼š
- âœ… æ”¯æŒ `--work-dir` æˆ– `-w`
- âœ… è‡ªåŠ¨éªŒè¯è·¯å¾„å­˜åœ¨æ€§
- âœ… è‡ªåŠ¨è½¬æ¢ä¸º `Path` å¯¹è±¡

---

#### æ­¥éª¤5ï¼šæ·»åŠ å‘½ä»¤å‚æ•°

```python
@click.option(
    "--command",
    "-c",
    type=str,
    default=None,
    help="ç”¨æˆ·æŸ¥è¯¢å‘½ä»¤ã€‚é»˜è®¤ï¼šäº¤äº’å¼è¾“å…¥",
)
def my_cli(verbose: bool, work_dir: Path, command: str | None):
    """My CLI - AIåŠ©æ‰‹å‘½ä»¤è¡Œå·¥å…·"""
    if verbose:
        print(f"[è¯¦ç»†] ç‰ˆæœ¬: {__version__}")
        print(f"[è¯¦ç»†] å·¥ä½œç›®å½•: {work_dir}")

    if command:
        print(f"ç”¨æˆ·å‘½ä»¤: {command}")
    else:
        print("ç­‰å¾…äº¤äº’å¼è¾“å…¥...")
```

**æ”¹è¿›**ï¼š
- âœ… æ”¯æŒ `--command` æˆ– `-c`
- âœ… æ”¯æŒå•å‘½ä»¤æ¨¡å¼å’Œäº¤äº’æ¨¡å¼

---

#### æ­¥éª¤6ï¼šæ·»åŠ UIæ¨¡å¼å‚æ•°

```python
from typing import Literal

UIMode = Literal["print", "shell"]

@click.option(
    "--ui",
    type=click.Choice(["print", "shell"]),
    default="print",
    help="UI æ¨¡å¼ã€‚é»˜è®¤ï¼šprint",
)
def my_cli(verbose: bool, work_dir: Path, command: str | None, ui: UIMode):
    """My CLI - AIåŠ©æ‰‹å‘½ä»¤è¡Œå·¥å…·"""
    if verbose:
        print(f"[è¯¦ç»†] ç‰ˆæœ¬: {__version__}")
        print(f"[è¯¦ç»†] å·¥ä½œç›®å½•: {work_dir}")
        print(f"[è¯¦ç»†] UI æ¨¡å¼: {ui}")

    if command:
        print(f"ç”¨æˆ·å‘½ä»¤: {command}")
        print(f"UI æ¨¡å¼: {ui}")
```

**æ”¹è¿›**ï¼š
- âœ… æ”¯æŒ `--ui` é€‰æ‹©
- âœ… é™åˆ¶åªèƒ½é€‰ `print` æˆ– `shell`
- âœ… ä½¿ç”¨ `Literal` ç±»å‹çº¦æŸ

---

#### æ­¥éª¤7ï¼šå¼•å…¥å¼‚æ­¥å…¥å£

**ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ**
1. LLM APIè°ƒç”¨æ˜¯å¼‚æ­¥çš„
2. UIæ¸²æŸ“éœ€è¦å¹¶å‘å¤„ç†
3. å·¥å…·æ‰§è¡Œå¯èƒ½éœ€è¦ç­‰å¾…

**å®ç°å¼‚æ­¥æ¡¥æ¥**ï¼š

```python
import asyncio

@click.command()
@click.version_option(__version__)
@click.option("--verbose", ...)
@click.option("--work-dir", "-w", ...)
@click.option("--command", "-c", ...)
@click.option("--ui", ...)
def my_cli(verbose: bool, work_dir: Path, command: str | None, ui: UIMode) -> None:
    """My CLI - AIåŠ©æ‰‹å‘½ä»¤è¡Œå·¥å…·"""
    # åŒæ­¥å…¥å£ï¼ˆClickè¦æ±‚ï¼‰
    asyncio.run(async_main(verbose, work_dir, command, ui))


async def async_main(
    verbose: bool, work_dir: Path, command: str | None, ui: UIMode
) -> None:
    """å¼‚æ­¥ä¸»å‡½æ•°"""
    print("=" * 60)
    print("My CLI - é˜¶æ®µ 1ï¼šæœ€ç®€ CLI å…¥å£")
    print("=" * 60)
    print()

    if verbose:
        print(f"[è¯¦ç»†] ç‰ˆæœ¬: {__version__}")
        print(f"[è¯¦ç»†] å·¥ä½œç›®å½•: {work_dir}")
        print(f"[è¯¦ç»†] UI æ¨¡å¼: {ui}")
        print()

    if command:
        print(f"ç”¨æˆ·å‘½ä»¤: {command}")
    else:
        print("ç­‰å¾…äº¤äº’å¼è¾“å…¥...")

    print()
    print("âœ… CLI æ¡†æ¶è¿è¡ŒæˆåŠŸï¼")
    print()
    print("ä¸‹ä¸€æ­¥ï¼š")
    print("  - é˜¶æ®µ 2ï¼šå®ç°åº”ç”¨å±‚æ¡†æ¶ï¼ˆapp.pyï¼‰")
    print("  - é˜¶æ®µ 3ï¼šå®ç° Print UI æ¨¡å¼")
    print("  - é˜¶æ®µ 4ï¼šå®ç° Soul æ ¸å¿ƒå¼•æ“")


if __name__ == "__main__":
    my_cli()
```

**æ”¹è¿›**ï¼š
- âœ… ä½¿ç”¨ `asyncio.run()` æ¡¥æ¥
- âœ… åŒæ­¥å…¥å£ + å¼‚æ­¥å®ç°
- âœ… ä¸ºåç»­å¼‚æ­¥åŠŸèƒ½æ‰“åŸºç¡€

---

## æ¨¡å—å¡«å……é¡ºåº

### å½“å‰çŠ¶æ€ï¼ˆStage 1å®Œæˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CLI å±‚ï¼ˆcli.pyï¼‰âœ…                   â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ @click.command()                            â”‚   â”‚
â”‚  â”‚ @click.option("--verbose")                  â”‚   â”‚
â”‚  â”‚ @click.option("--work-dir")                 â”‚   â”‚
â”‚  â”‚ @click.option("--command")                  â”‚   â”‚
â”‚  â”‚ @click.option("--ui")                       â”‚   â”‚
â”‚  â”‚                                             â”‚   â”‚
â”‚  â”‚ def my_cli(...):                            â”‚   â”‚
â”‚  â”‚     asyncio.run(async_main(...))            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ async def async_main(...):                  â”‚   â”‚
â”‚  â”‚     print("CLI æ¡†æ¶è¿è¡ŒæˆåŠŸï¼")               â”‚   â”‚
â”‚  â”‚     # ä¸‹ä¸€æ­¥ï¼šè°ƒç”¨ App å±‚                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ âŒ æš‚æœªå®ç°
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  App å±‚ï¼ˆapp.pyï¼‰âŒ                   â”‚
â”‚  â€¢ å¾…å®ç°...                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‹ä¸€æ­¥ï¼ˆStage 2ï¼‰

**è¦å¡«å……çš„æ¨¡å—ï¼šAppå±‚ï¼ˆapp.pyï¼‰**

```python
# my_cli/app.pyï¼ˆå¾…åˆ›å»ºï¼‰

class MyCLI:
    """åº”ç”¨å±‚ï¼šåè°ƒCLIã€UIã€Soul"""

    def __init__(self, work_dir: Path, verbose: bool):
        self.work_dir = work_dir
        self.verbose = verbose
        # ä¸‹ä¸€æ­¥ï¼šåˆå§‹åŒ– Soul

    async def run_print_mode(self, command: str | None):
        """è¿è¡Œ Print UI æ¨¡å¼"""
        # å¾…å®ç°...

    async def run_shell_mode(self, command: str | None):
        """è¿è¡Œ Shell UI æ¨¡å¼"""
        # å¾…å®ç°...
```

**ä¿®æ”¹ cli.py**ï¼š
```python
async def async_main(verbose: bool, work_dir: Path, command: str | None, ui: UIMode):
    # åˆ›å»º App å®ä¾‹
    from my_cli.app import MyCLI
    app = MyCLI(work_dir=work_dir, verbose=verbose)

    # è·¯ç”±åˆ°ä¸åŒçš„ UI æ¨¡å¼
    if ui == "print":
        await app.run_print_mode(command)
    elif ui == "shell":
        await app.run_shell_mode(command)
```

---

## æ•°æ®æµå›¾

### Stage 1ï¼ˆå½“å‰ï¼‰ï¼šå•å‘æµ

```
ç”¨æˆ·è¾“å…¥
   â”‚
   â”‚ $ python cli.py -c "Hello" --verbose
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Click å‚æ•°è§£æ                       â”‚
â”‚  â€¢ verbose = True                    â”‚
â”‚  â€¢ work_dir = Path.cwd()             â”‚
â”‚  â€¢ command = "Hello"                 â”‚
â”‚  â€¢ ui = "print"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ my_cli(...)
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  asyncio.run(async_main(...))        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ async_main(...)
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰“å°ä¿¡æ¯åˆ°ç»ˆç«¯                       â”‚
â”‚  â€¢ ç‰ˆæœ¬ä¿¡æ¯                          â”‚
â”‚  â€¢ å·¥ä½œç›®å½•                          â”‚
â”‚  â€¢ ç”¨æˆ·å‘½ä»¤                          â”‚
â”‚  â€¢ æˆåŠŸæç¤º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
         ç”¨æˆ·çœ‹åˆ°è¾“å‡º
```

### Stage 2ï¼ˆä¸‹ä¸€æ­¥ï¼‰ï¼šåŒå‘æµ

```
ç”¨æˆ·è¾“å…¥
   â”‚
   â†“
CLI å‚æ•°è§£æ
   â”‚
   â†“
async_main()
   â”‚
   â”‚ åˆ›å»º MyCLI å®ä¾‹
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App å±‚ï¼ˆMyCLIï¼‰                â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ run_print_mode(command)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ åˆ›å»º Soul å®ä¾‹
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Soul å±‚         â”‚  â† Stage 4 å®ç°
    â”‚  â€¢ è°ƒç”¨ LLM      â”‚
    â”‚  â€¢ æ‰§è¡Œå·¥å…·      â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ è¿”å›å“åº”
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Print UI        â”‚  â† Stage 3 å®ç°
    â”‚  â€¢ æ˜¾ç¤ºå“åº”      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
       ç”¨æˆ·çœ‹åˆ°è¾“å‡º
```

---

## ä¸‹ä¸€æ­¥é¢„å‘Š
### Stage 2ï¼šå®ç°Appå±‚ï¼ˆapp.pyï¼‰

**è¦åšçš„äº‹æƒ…**ï¼š

1. **åˆ›å»º `my_cli/app.py`**
   ```python
   class MyCLI:
       def __init__(self, work_dir: Path, verbose: bool):
           self.work_dir = work_dir
           self.verbose = verbose

       async def run_print_mode(self, command: str | None):
           """è¿è¡Œ Print UI æ¨¡å¼"""
           pass

       async def run_shell_mode(self, command: str | None):
           """è¿è¡Œ Shell UI æ¨¡å¼"""
           pass
   ```

2. **ä¿®æ”¹ `cli.py`**
   - åœ¨ `async_main` ä¸­åˆ›å»º `MyCLI` å®ä¾‹
   - è°ƒç”¨å¯¹åº”çš„ `run_xxx_mode` æ–¹æ³•

3. **èŒè´£åˆ†ç¦»**
   - CLIå±‚ï¼šåªè´Ÿè´£å‚æ•°è§£æ
   - Appå±‚ï¼šè´Ÿè´£åè°ƒå’Œè·¯ç”±
   - Soulå±‚ï¼šè´Ÿè´£AIé€»è¾‘ï¼ˆStage 4ï¼‰
   - UIå±‚ï¼šè´Ÿè´£æ˜¾ç¤ºï¼ˆStage 3ï¼‰

### Stage 3ï¼šå®ç°Print UIï¼ˆui/print/ui_print.pyï¼‰

**è¦åšçš„äº‹æƒ…**ï¼š

1. **åˆ›å»º `my_cli/ui/print/ui_print.py`**
   ```python
   class PrintUI:
       def display(self, message: str):
           """æ˜¾ç¤ºæ¶ˆæ¯"""
           print(message)

       def display_tool_call(self, tool_name: str, args: dict):
           """æ˜¾ç¤ºå·¥å…·è°ƒç”¨"""
           print(f"ğŸ”§ è°ƒç”¨å·¥å…·: {tool_name}")
   ```

2. **åœ¨Appå±‚ä¸­ä½¿ç”¨UI**
   ```python
   async def run_print_mode(self, command: str | None):
       ui = PrintUI()
       ui.display(f"æ”¶åˆ°å‘½ä»¤: {command}")
   ```

### Stage 4ï¼šå®ç°Soulå¼•æ“ï¼ˆsoul.pyï¼‰

**è¦åšçš„äº‹æƒ…**ï¼š

1. **åˆ›å»º `my_cli/soul.py`**
   ```python
   class Soul:
       def __init__(self, work_dir: Path):
           self.work_dir = work_dir
           self.llm_client = self._init_llm_client()

       async def run(self, ui, command: str):
           """ä¸»å¾ªç¯"""
           # 1. è°ƒç”¨ LLM
           response = await self.llm_client.chat(command)

           # 2. æ˜¾ç¤ºå“åº”
           ui.display(response)

           # 3. æ‰§è¡Œå·¥å…·ï¼ˆå¦‚æœæœ‰ï¼‰
           if response.tool_calls:
               await self.execute_tools(response.tool_calls)
   ```

2. **é›†æˆLLM API**
   - ä½¿ç”¨ Moonshot API
   - å®ç°åŸºæœ¬çš„å¯¹è¯åŠŸèƒ½

---

## æ¶æ„æ¼”è¿›æ€»ç»“

### é˜¶æ®µå¯¹æ¯”è¡¨

| é˜¶æ®µ | CLIå±‚ | Appå±‚ | UIå±‚ | Soulå±‚ | Toolså±‚ | èƒ½åšä»€ä¹ˆ |
|------|-------|-------|------|--------|---------|---------|
| **Stage 0** | âŒ | âŒ | âŒ | âŒ | âŒ | åªèƒ½æ‰“å°"Hello" |
| **Stage 1** | âœ… | âŒ | âŒ | âŒ | âŒ | èƒ½æ¥æ”¶å‚æ•°ï¼Œæ‰“å°ä¿¡æ¯ |
| **Stage 2** | âœ… | âœ… | âŒ | âŒ | âŒ | æœ‰åº”ç”¨å±‚åè°ƒ |
| **Stage 3** | âœ… | âœ… | âœ… | âŒ | âŒ | èƒ½æ˜¾ç¤ºUIï¼ˆä½†æ²¡æœ‰AIï¼‰ |
| **Stage 4** | âœ… | âœ… | âœ… | âœ… | âŒ | èƒ½è°ƒç”¨AIï¼ˆä½†æ²¡å·¥å…·ï¼‰ |
| **Stage 5+** | âœ… | âœ… | âœ… | âœ… | âœ… | å®Œæ•´åŠŸèƒ½ï¼ |

### å…³é”®è®¾è®¡åŸåˆ™

1. **åˆ†å±‚æ¶æ„**ï¼šCLI â†’ App â†’ Soul â†’ Tools/UI
2. **èŒè´£å•ä¸€**ï¼šæ¯å±‚åªåšè‡ªå·±çš„äº‹
3. **æ¸è¿›å¼å¼€å‘**ï¼šä¸€æ­¥ä¸€æ­¥å¡«å……åŠŸèƒ½
4. **å¼‚æ­¥ä¼˜å…ˆ**ï¼šä»CLIå…¥å£å°±å¼€å§‹ä½¿ç”¨å¼‚æ­¥

---

## å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹ 1ï¼šç†è§£æ•°æ®æµ

**é—®é¢˜**ï¼šç”¨æˆ·æ‰§è¡Œ `python cli.py -c "Hello" --verbose`ï¼Œæ•°æ®æ˜¯å¦‚ä½•æµåŠ¨çš„ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
1. Clickè§£æå‚æ•° â†’ `verbose=True, command="Hello"`
2. è°ƒç”¨ `my_cli(verbose=True, command="Hello", ...)`
3. `my_cli` è°ƒç”¨ `asyncio.run(async_main(...))`
4. `async_main` æ‰“å°è¯¦ç»†ä¿¡æ¯å’Œå‘½ä»¤
5. ç”¨æˆ·çœ‹åˆ°è¾“å‡º

### ç»ƒä¹ 2ï¼šé¢„æµ‹ä¸‹ä¸€æ­¥

**é—®é¢˜**ï¼šStage 2å®Œæˆåï¼Œ`async_main` å‡½æ•°ä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
```python
async def async_main(verbose: bool, work_dir: Path, command: str | None, ui: UIMode):
    # åˆ›å»º App å®ä¾‹
    app = MyCLI(work_dir=work_dir, verbose=verbose)

    # è·¯ç”±åˆ°å¯¹åº”çš„ UI æ¨¡å¼
    if ui == "print":
        await app.run_print_mode(command)
    elif ui == "shell":
        await app.run_shell_mode(command)
```

### ç»ƒä¹ 3ï¼šæ¶æ„æ‰©å±•

**é—®é¢˜**ï¼šå¦‚æœè¦æ·»åŠ ä¸€ä¸ªæ–°çš„ UI æ¨¡å¼ï¼ˆå¦‚ `web`ï¼‰ï¼Œéœ€è¦ä¿®æ”¹å“ªäº›æ–‡ä»¶ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
1. `cli.py`ï¼šä¿®æ”¹ `UIMode = Literal["print", "shell", "web"]`
2. `cli.py`ï¼šä¿®æ”¹ `click.Choice(["print", "shell", "web"])`
3. `app.py`ï¼šæ·»åŠ  `async def run_web_mode(self, command)` æ–¹æ³•
4. `async_main`ï¼šæ·»åŠ è·¯ç”±åˆ†æ”¯ `elif ui == "web": await app.run_web_mode(command)`
5. åˆ›å»º `my_cli/ui/web/ui_web.py`ï¼šå®ç°Web UI

---

## æ€»ç»“

### Stage 1 å®Œæˆçš„åŠŸèƒ½

âœ… **CLIå±‚å®Œæ•´æ­å»º**ï¼š
- Clickæ¡†æ¶é›†æˆ
- å‚æ•°è§£æï¼ˆverbose, work-dir, command, uiï¼‰
- å‚æ•°éªŒè¯
- å¼‚æ­¥å…¥å£æ¡¥æ¥

âœ… **ä¸ºåç»­é˜¶æ®µæ‰“åŸºç¡€**ï¼š
- ä¸‰å±‚æ¶æ„æ¸…æ™°
- å¼‚æ­¥ç¼–ç¨‹å°±ç»ª
- ç±»å‹æ³¨è§£è§„èŒƒ
- æ‰©å±•æ€§å¼º

### å…³é”®æ”¶è·

1. **Clickæ¡†æ¶**ï¼šç®€æ´çš„å‘½ä»¤è¡Œå·¥å…·å¼€å‘
2. **å¼‚æ­¥ç¼–ç¨‹**ï¼š`asyncio.run()` æ¡¥æ¥åŒæ­¥å’Œå¼‚æ­¥
3. **ç±»å‹æ³¨è§£**ï¼š`Literal`ã€`Path`ã€`str | None` ç­‰
4. **åˆ†å±‚æ€æƒ³**ï¼šCLI â†’ App â†’ Soul é€æ­¥æ·±å…¥

### ä¸‹ä¸€æ­¥æ–¹å‘

ğŸ“– **é˜…è¯»é¡ºåº**ï¼š
1. æœ¬æ–‡æ¡£ï¼ˆæ¶æ„æµç¨‹ï¼‰ â† **ä½ åœ¨è¿™é‡Œ**
2. `stage-01-cli-entry.md`ï¼ˆä»£ç è¯¦è§£ï¼‰
3. `stage-02-æ¶æ„.md`ï¼ˆAppå±‚å¡«å……ï¼‰â† **ä¸‹ä¸€æ­¥**

ğŸš€ **åŠ¨æ‰‹å®è·µ**ï¼š
1. è¿è¡Œ `python cli.py --help`
2. è¿è¡Œ `python cli.py -c "test" --verbose`
3. å°è¯•æ·»åŠ æ–°å‚æ•°ï¼ˆå¦‚ `--model`ï¼‰
4. å‡†å¤‡å®ç° Stage 2

---

**è€ç‹çš„å»ºè®®**ï¼š
- ğŸ§± æ¶æ„è¦ä¸€æ­¥æ­¥æ­ï¼Œä¸è¦ç€æ€¥ï¼
- ğŸ“š å…ˆç†è§£æµç¨‹ï¼Œå†å†™ä»£ç 
- ğŸ” å¤šçœ‹å®˜æ–¹å®ç°ï¼Œç†è§£è®¾è®¡æ€è·¯
- âœ… æ¯ä¸ªé˜¶æ®µéƒ½è¦æµ‹è¯•é€šè¿‡å†è¿›å…¥ä¸‹ä¸€é˜¶æ®µ

**ç°åœ¨ä½ å·²ç»ç†è§£ Stage 1 çš„æ¶æ„å¡«å……æµç¨‹äº†ï¼å‡†å¤‡å¥½è¿›å…¥ Stage 2 äº†å—ï¼Ÿ** ğŸš€