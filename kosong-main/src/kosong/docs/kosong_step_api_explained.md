# kosong.step() API å®Œå…¨è§£æ

## ğŸ“š æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ·±åº¦è§£æ `kosong.step()` API çš„å†…éƒ¨å·¥ä½œæœºåˆ¶ï¼Œé‡ç‚¹è®²è§£ï¼š
1. å®ƒå¦‚ä½•è°ƒç”¨ LLM å’Œå·¥å…·
2. `StepResult` çš„ç»“æ„å’Œç”¨é€”
3. å·¥å…·æ‰§è¡Œçš„å®Œæ•´æµç¨‹
4. ä¸ `kosong.generate()` çš„åŒºåˆ«

**æºç ä½ç½®**ï¼š`kosong-main/src/kosong/__init__.py:104-217`

---

## ğŸ¯ kosong.step() çš„è®¾è®¡ç›®æ ‡

`kosong.step()` æ˜¯ä¸€ä¸ª**å•æ­¥ Agent æ‰§è¡Œå‡½æ•°**ï¼Œå®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š

- âœ… **è°ƒç”¨ä¸€æ¬¡ LLM**ï¼ˆå¯èƒ½åŒ…å«å·¥å…·è°ƒç”¨è¯·æ±‚ï¼‰
- âœ… **è‡ªåŠ¨æ‰§è¡Œ LLM è¯·æ±‚çš„å·¥å…·**ï¼ˆå¼‚æ­¥ã€éé˜»å¡ï¼‰
- âœ… **è¿”å› StepResult**ï¼ˆåŒ…å« LLM å“åº” + å·¥å…·æ‰§è¡Œ Futureï¼‰
- âœ… **æµå¼è¾“å‡ºå‹å¥½**ï¼ˆé€šè¿‡å›è°ƒå®æ—¶å‘é€æ¶ˆæ¯ç‰‡æ®µï¼‰

**å…³é”®è®¾è®¡ç†å¿µ**ï¼š
> ä¸€æ¬¡ `kosong.step()` = ä¸€æ¬¡ LLM è°ƒç”¨ + è¯¥æ¬¡è°ƒç”¨ä¸­çš„æ‰€æœ‰å·¥å…·æ‰§è¡Œ

**ä¸ºä»€ä¹ˆå« "step"ï¼Ÿ**
å› ä¸ºåœ¨ Agent å¾ªç¯ä¸­ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ `kosong.step()` å°±æ˜¯æ¨è¿›ä¸€æ­¥ï¼š
```
Step 1: ç”¨æˆ·è¾“å…¥ â†’ LLM å†³å®šè°ƒç”¨ Bash å·¥å…·
Step 2: Bash ç»“æœ â†’ LLM å†³å®šè°ƒç”¨ ReadFile å·¥å…·
Step 3: ReadFile ç»“æœ â†’ LLM ç»™å‡ºæœ€ç»ˆç­”æ¡ˆï¼ˆæ— å·¥å…·è°ƒç”¨ï¼Œå¾ªç¯ç»“æŸï¼‰
```

---

## ğŸ“ å‡½æ•°ç­¾å

```python
async def step(
    chat_provider: ChatProvider,        # LLM æä¾›è€…ï¼ˆKimiã€OpenAI ç­‰ï¼‰
    system_prompt: str,                 # ç³»ç»Ÿæç¤ºè¯ï¼ˆAgent èº«ä»½ï¼‰
    toolset: Toolset,                   # å·¥å…·é›†ï¼ˆå®ç° Toolset åè®®ï¼‰
    history: Sequence[Message],         # å¯¹è¯å†å²ï¼ˆåŒ…å«ç”¨æˆ·æ¶ˆæ¯ã€LLM å“åº”ã€å·¥å…·ç»“æœï¼‰
    *,
    on_message_part: Callback[[StreamedMessagePart], None] | None = None,
    on_tool_result: Callable[[ToolResult], None] | None = None,
) -> "StepResult":
    """
    æ‰§è¡Œä¸€æ­¥ Agent æ¨ç†ï¼šè°ƒç”¨ LLM + æ‰§è¡Œå·¥å…·

    Returns:
        StepResult: åŒ…å« LLM å“åº”æ¶ˆæ¯ã€å·¥å…·è°ƒç”¨åˆ—è¡¨ã€å·¥å…·ç»“æœ Future
    """
```

---

## ğŸ”„ å·¥ä½œæµç¨‹ï¼ˆå®Œæ•´ç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     kosong.step() è°ƒç”¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‡†å¤‡é˜¶æ®µ                                                     â”‚
â”‚    â”œâ”€ tool_calls: list[ToolCall] = []                          â”‚
â”‚    â”œâ”€ tool_result_futures: dict[str, ToolResultFuture] = {}    â”‚
â”‚    â””â”€ å®šä¹‰ on_tool_call() å›è°ƒå‡½æ•°                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è°ƒç”¨ kosong.generate()                                      â”‚
â”‚    â”œâ”€ ä¼ å…¥ system_promptã€historyã€toolset.tools               â”‚
â”‚    â”œâ”€ ä¼ å…¥ on_message_part å›è°ƒï¼ˆæµå¼æ–‡æœ¬ç‰‡æ®µï¼‰                â”‚
â”‚    â”œâ”€ ä¼ å…¥ on_tool_call å›è°ƒï¼ˆå·¥å…·è°ƒç”¨è¯·æ±‚ï¼‰â­                 â”‚
â”‚    â””â”€ LLM å¼€å§‹æµå¼ç”Ÿæˆå“åº”...                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  LLM ç”Ÿæˆå†…å®¹       â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ LLM å¯èƒ½ç”Ÿæˆä¸¤ç§å†…å®¹ï¼š                  â”‚
        â”‚                                         â”‚
        â”‚  A. æ–‡æœ¬å†…å®¹ï¼ˆTextPartï¼‰                â”‚
        â”‚     â”œâ”€ è§¦å‘ on_message_part(TextPart)   â”‚
        â”‚     â””â”€ å‘é€åˆ° Wire â†’ UI å®æ—¶æ˜¾ç¤º        â”‚
        â”‚                                         â”‚
        â”‚  B. å·¥å…·è°ƒç”¨ï¼ˆToolCallï¼‰â­              â”‚
        â”‚     â”œâ”€ è§¦å‘ on_tool_call(ToolCall)      â”‚
        â”‚     â””â”€ è¿›å…¥å·¥å…·æ‰§è¡Œæµç¨‹ï¼ˆè§ä¸‹æ–¹ï¼‰       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. on_tool_call() å›è°ƒè¢«è§¦å‘ï¼ˆæ¯ä¸ªå·¥å…·è°ƒç”¨ä¸€æ¬¡ï¼‰â­             â”‚
â”‚                                                                 â”‚
â”‚    async def on_tool_call(tool_call: ToolCall):                â”‚
â”‚        # 3.1 è®°å½•å·¥å…·è°ƒç”¨                                      â”‚
â”‚        tool_calls.append(tool_call)                            â”‚
â”‚                                                                 â”‚
â”‚        # 3.2 è°ƒç”¨ Toolset å¤„ç†å·¥å…· â­â­â­                       â”‚
â”‚        result = toolset.handle(tool_call)                      â”‚
â”‚        # â†‘ å…³é”®ï¼è¿™é‡Œè°ƒç”¨ SimpleToolset.handle()               â”‚
â”‚        #   å®ƒä¼šï¼š                                               â”‚
â”‚        #   - åˆ›å»º ToolResultFuture                             â”‚
â”‚        #   - å¯åŠ¨ asyncio.create_task(_execute_tool())         â”‚
â”‚        #   - ç«‹å³è¿”å› Futureï¼ˆä¸ç­‰å¾…æ‰§è¡Œå®Œæˆï¼‰                 â”‚
â”‚                                                                 â”‚
â”‚        # 3.3 å¤„ç†è¿”å›å€¼ï¼ˆFuture æˆ– Resultï¼‰                    â”‚
â”‚        if isinstance(result, ToolResult):                      â”‚
â”‚            # åŒæ­¥å·¥å…·ï¼šç«‹å³å®Œæˆ                                â”‚
â”‚            future = ToolResultFuture()                         â”‚
â”‚            future.add_done_callback(future_done_callback)      â”‚
â”‚            future.set_result(result)                           â”‚
â”‚            tool_result_futures[tool_call.id] = future          â”‚
â”‚        else:                                                    â”‚
â”‚            # å¼‚æ­¥å·¥å…·ï¼šè¿”å› Future                             â”‚
â”‚            result.add_done_callback(future_done_callback) â­   â”‚
â”‚            tool_result_futures[tool_call.id] = result          â”‚
â”‚                                                                 â”‚
â”‚    # future_done_callback çš„ä½œç”¨ï¼š                             â”‚
â”‚    # - å·¥å…·æ‰§è¡Œå®Œæˆæ—¶ï¼Œè°ƒç”¨ on_tool_result(ToolResult)         â”‚
â”‚    # - å®æ—¶å‘é€åˆ° Wire â†’ UI æ˜¾ç¤ºå·¥å…·ç»“æœ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç­‰å¾… kosong.generate() å®Œæˆ                                 â”‚
â”‚    â”œâ”€ LLM æµå¼è¾“å‡ºå®Œæˆ                                         â”‚
â”‚    â”œâ”€ æ‰€æœ‰å·¥å…·è°ƒç”¨å·²è§¦å‘ï¼ˆä½†å¯èƒ½è¿˜åœ¨æ‰§è¡Œä¸­ï¼ï¼‰                 â”‚
â”‚    â””â”€ è¿”å› GenerateResult(id, message, usage)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ„é€ å¹¶è¿”å› StepResult â­                                    â”‚
â”‚                                                                 â”‚
â”‚    return StepResult(                                          â”‚
â”‚        id=result.id,              # LLM å“åº” ID                â”‚
â”‚        message=result.message,    # LLM ç”Ÿæˆçš„æ¶ˆæ¯ï¼ˆå« ToolCallï¼‰â”‚
â”‚        usage=result.usage,        # Token ä½¿ç”¨ç»Ÿè®¡             â”‚
â”‚        tool_calls=tool_calls,     # å·¥å…·è°ƒç”¨åˆ—è¡¨               â”‚
â”‚        _tool_result_futures=tool_result_futures,  # Future å­—å…¸â”‚
â”‚    )                                                            â”‚
â”‚                                                                 â”‚
â”‚    æ³¨æ„ï¼šæ­¤æ—¶è¿”å›ï¼Œå·¥å…·å¯èƒ½è¿˜åœ¨åå°æ‰§è¡Œï¼                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. è°ƒç”¨æ–¹ç­‰å¾…å·¥å…·å®Œæˆï¼ˆå¯é€‰ï¼‰                                   â”‚
â”‚                                                                 â”‚
â”‚    result = await kosong.step(...)                             â”‚
â”‚    tool_results = await result.tool_results()  # â­ ç­‰å¾…æ‰€æœ‰å·¥å…·â”‚
â”‚                                                                 â”‚
â”‚    tool_results() å†…éƒ¨é€»è¾‘ï¼š                                    â”‚
â”‚    - éå† tool_calls                                            â”‚
â”‚    - æ ¹æ® tool_call.id å–å‡ºå¯¹åº”çš„ Future                        â”‚
â”‚    - await future ç­‰å¾…å·¥å…·æ‰§è¡Œå®Œæˆ                              â”‚
â”‚    - æ”¶é›†æ‰€æœ‰ ToolResult å¹¶è¿”å›                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© æ ¸å¿ƒæ•°æ®ç»“æ„

### 1. StepResult

```python
@dataclass(frozen=True, slots=True)
class StepResult:
    """
    å•æ­¥ Agent æ‰§è¡Œç»“æœ

    åŒ…å«ï¼š
    - LLM å“åº”æ¶ˆæ¯
    - å·¥å…·è°ƒç”¨åˆ—è¡¨
    - å·¥å…·æ‰§è¡Œ Futureï¼ˆç”¨äºç­‰å¾…å·¥å…·å®Œæˆï¼‰
    """

    id: str | None
    """LLM å“åº” IDï¼ˆChatProvider è¿”å›ï¼‰"""

    message: Message
    """
    LLM ç”Ÿæˆçš„æ¶ˆæ¯

    ç»“æ„ï¼š
    - role: "assistant"
    - content: [TextPart(...), ...]  # LLM ç”Ÿæˆçš„æ–‡æœ¬
    - tool_calls: [ToolCall(...), ...]  # LLM è¯·æ±‚çš„å·¥å…·è°ƒç”¨ï¼ˆå¯é€‰ï¼‰
    """

    usage: TokenUsage | None
    """Token ä½¿ç”¨ç»Ÿè®¡ï¼ˆprompt_tokens, completion_tokensï¼‰"""

    tool_calls: list[ToolCall]
    """
    å·¥å…·è°ƒç”¨åˆ—è¡¨ï¼ˆä» message.tool_calls å¤åˆ¶ï¼‰

    æ–¹ä¾¿åˆ¤æ–­ï¼š
    if not result.tool_calls:
        # æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼ŒAgent å¾ªç¯å¯ä»¥é€€å‡º
    """

    _tool_result_futures: dict[str, ToolResultFuture]
    """
    å·¥å…·ç»“æœ Future å­—å…¸

    æ ¼å¼ï¼š{tool_call.id: ToolResultFuture}
    ç”¨é€”ï¼šç­‰å¾…å¼‚æ­¥å·¥å…·æ‰§è¡Œå®Œæˆ
    """

    async def tool_results(self) -> list[ToolResult]:
        """
        ç­‰å¾…æ‰€æœ‰å·¥å…·æ‰§è¡Œå®Œæˆå¹¶è¿”å›ç»“æœ

        æµç¨‹ï¼š
        1. å¦‚æœæ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å›ç©ºåˆ—è¡¨
        2. éå† tool_calls
        3. å–å‡ºå¯¹åº”çš„ Future
        4. await future ç­‰å¾…å®Œæˆ
        5. æ”¶é›†æ‰€æœ‰ ToolResult

        Returns:
            æŒ‰ tool_calls é¡ºåºæ’åˆ—çš„ ToolResult åˆ—è¡¨
        """
        if not self._tool_result_futures:
            return []

        results: list[ToolResult] = []
        for tool_call in self.tool_calls:
            future = self._tool_result_futures.pop(tool_call.id)
            result = await future  # â­ ç­‰å¾…å·¥å…·æ‰§è¡Œå®Œæˆ
            results.append(result)

        return results
```

### 2. ToolCallï¼ˆåµŒå¥—ç»“æ„ï¼‰â­

```python
class ToolCall(BaseModel):
    """
    å·¥å…·è°ƒç”¨è¯·æ±‚ï¼ˆLLM ç”Ÿæˆï¼‰

    é‡è¦ï¼šè¿™æ˜¯åµŒå¥—ç»“æ„ï¼
    - tool_call.function.name æ‰æ˜¯å·¥å…·åç§°
    - tool_call.function.arguments æ‰æ˜¯å‚æ•°ï¼ˆJSON å­—ç¬¦ä¸²ï¼‰
    """

    type: str = "function"
    """å›ºå®šä¸º "function"""

    id: str
    """å·¥å…·è°ƒç”¨ IDï¼ˆç”¨äºå…³è” ToolResultï¼‰"""

    function: ToolCall.FunctionBody  # â­ åµŒå¥—ç»“æ„
    """å·¥å…·è°ƒç”¨çš„å…·ä½“å†…å®¹"""

    class FunctionBody(BaseModel):
        name: str
        """å·¥å…·åç§°ï¼ˆå¦‚ "Bash", "ReadFile"ï¼‰"""

        arguments: str
        """
        å·¥å…·å‚æ•°ï¼ˆJSON å­—ç¬¦ä¸²æ ¼å¼ï¼‰

        ç¤ºä¾‹ï¼š
        '{"command": "ls -la"}'
        '{"file_path": "/tmp/test.txt", "limit": 10}'

        ä½¿ç”¨æ—¶éœ€è¦ï¼š
        import json
        args = json.loads(tool_call.function.arguments)
        """
```

**å¸¸è§é”™è¯¯**ï¼š
```python
# âŒ é”™è¯¯
tool_name = tool_call.name  # AttributeError!
arguments = tool_call.arguments  # AttributeError!

# âœ… æ­£ç¡®
tool_name = tool_call.function.name
arguments_str = tool_call.function.arguments
arguments = json.loads(arguments_str)
```

### 3. ToolResult

```python
@dataclass(frozen=True, slots=True)
class ToolResult:
    """å·¥å…·æ‰§è¡Œç»“æœ"""

    tool_call_id: str
    """å…³è”çš„ ToolCall ID"""

    result: ToolOk | ToolError
    """
    å·¥å…·æ‰§è¡Œç»“æœï¼š
    - ToolOk: æˆåŠŸï¼ˆåŒ…å« output å’Œ briefï¼‰
    - ToolError: å¤±è´¥ï¼ˆåŒ…å« message å’Œ briefï¼‰
    """

class ToolOk(BaseModel):
    """å·¥å…·æ‰§è¡ŒæˆåŠŸ"""
    output: Any  # å·¥å…·è¾“å‡ºï¼ˆå­—ç¬¦ä¸²ã€å¯¹è±¡ç­‰ï¼‰
    brief: str   # ç®€çŸ­æè¿°ï¼ˆå¦‚ "Success"ï¼‰

class ToolError(BaseModel):
    """å·¥å…·æ‰§è¡Œå¤±è´¥"""
    message: str  # é”™è¯¯è¯¦æƒ…
    brief: str    # ç®€çŸ­æè¿°ï¼ˆå¦‚ "Execution failed"ï¼‰
```

---

## ğŸ”§ å…³é”®å›è°ƒæœºåˆ¶

### 1. on_message_partï¼ˆæµå¼æ–‡æœ¬ç‰‡æ®µï¼‰

```python
on_message_part: Callback[[StreamedMessagePart], None] | None = None
```

**ä½œç”¨**ï¼šLLM ç”Ÿæˆæ–‡æœ¬æ—¶å®æ—¶å›è°ƒ

**å…¸å‹ç”¨æ³•**ï¼š
```python
from my_cli.soul import wire_send

result = await kosong.step(
    ...,
    on_message_part=wire_send,  # å®æ—¶å‘é€åˆ° Wire â†’ UI æ˜¾ç¤º
)
```

**å›è°ƒæ—¶æœº**ï¼š
- LLM æ¯ç”Ÿæˆä¸€ä¸ªæ–‡æœ¬ç‰‡æ®µï¼ˆé€šå¸¸å‡ ä¸ª tokenï¼‰å°±è§¦å‘ä¸€æ¬¡
- å®ç°é€å­—è¾“å‡ºæ•ˆæœ

**StreamedMessagePart ç±»å‹**ï¼š
```python
type StreamedMessagePart = TextPart | ThinkingPart | ToolCall
```

### 2. on_tool_resultï¼ˆå·¥å…·ç»“æœï¼‰

```python
on_tool_result: Callable[[ToolResult], None] | None = None
```

**ä½œç”¨**ï¼šå·¥å…·æ‰§è¡Œå®Œæˆæ—¶å›è°ƒ

**å…¸å‹ç”¨æ³•**ï¼š
```python
result = await kosong.step(
    ...,
    on_tool_result=wire_send,  # å·¥å…·å®Œæˆåç«‹å³å‘é€åˆ° Wire
)
```

**å›è°ƒæ—¶æœº**ï¼š
- å·¥å…·å¼‚æ­¥æ‰§è¡Œå®Œæˆæ—¶ï¼ˆé€šè¿‡ `future.add_done_callback`ï¼‰
- å¯èƒ½åœ¨ `kosong.step()` è¿”å›ä¹‹åæ‰è§¦å‘ï¼

**å†…éƒ¨å®ç°**ï¼š
```python
def future_done_callback(future: ToolResultFuture) -> None:
    if on_tool_result is None:
        return
    try:
        tool_result = future.result()
        on_tool_result(tool_result)  # â­ è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„å›è°ƒ
    except BaseException:
        pass  # å¿½ç•¥é”™è¯¯
```

---

## ğŸ†š kosong.step() vs kosong.generate()

| ç‰¹æ€§ | kosong.generate() | kosong.step() |
|------|-------------------|---------------|
| **æ ¸å¿ƒåŠŸèƒ½** | è°ƒç”¨ LLM ç”Ÿæˆå“åº” | è°ƒç”¨ LLM + æ‰§è¡Œå·¥å…· |
| **å·¥å…·æ”¯æŒ** | âŒ ä¸æ‰§è¡Œå·¥å…·ï¼ˆä»…ä¼ é€’ tools å®šä¹‰ï¼‰ | âœ… è‡ªåŠ¨æ‰§è¡Œå·¥å…· |
| **è¿”å›å€¼** | `GenerateResult` | `StepResult` |
| **å·¥å…·è°ƒç”¨** | åœ¨ `message.tool_calls` ä¸­ | åœ¨ `tool_calls` + `_tool_result_futures` |
| **å¼‚æ­¥å·¥å…·** | âŒ éœ€è¦æ‰‹åŠ¨å¤„ç† | âœ… è‡ªåŠ¨ç®¡ç† Future |
| **æµå¼è¾“å‡º** | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| **å›è°ƒ** | `on_message_part`, `on_tool_call` | `on_message_part`, `on_tool_result` â­ |
| **å…¸å‹ç”¨é€”** | å•æ¬¡ LLM è°ƒç”¨ | Agent å¾ªç¯ï¼ˆLLM â†” Toolï¼‰ |

**å…³é”®åŒºåˆ«**ï¼š
- `kosong.generate()`ï¼šåªè°ƒç”¨ LLMï¼Œä¸ç®¡å·¥å…·æ‰§è¡Œ
- `kosong.step()`ï¼šè°ƒç”¨ LLM å¹¶è‡ªåŠ¨æ‰§è¡Œå·¥å…·ï¼Œè¿”å› Future ä¾›åç»­ç­‰å¾…

---

## ğŸ’¡ å…¸å‹ä½¿ç”¨æ¨¡å¼

### æ¨¡å¼ 1ï¼šAgent å¾ªç¯ï¼ˆæ¨èï¼‰â­

```python
# Agent å¾ªç¯ï¼šæŒç»­æ¨ç†ç›´åˆ°ä¸å†éœ€è¦å·¥å…·
MAX_STEPS = 20
step_no = 1

while step_no <= MAX_STEPS:
    # 1. è°ƒç”¨ kosong.step()
    result = await kosong.step(
        chat_provider=chat_provider,
        system_prompt=system_prompt,
        toolset=toolset,
        history=context.get_messages(),
        on_message_part=wire_send,
        on_tool_result=wire_send,
    )

    # 2. ç­‰å¾…å·¥å…·æ‰§è¡Œå®Œæˆ
    tool_results = await result.tool_results()

    # 3. å°† LLM å“åº”æ·»åŠ åˆ° Context
    await context.append_message(result.message)

    # 4. å°†å·¥å…·ç»“æœæ·»åŠ åˆ° Context
    if tool_results:
        for tr in tool_results:
            tool_msg = Message(
                role="tool",
                content=[TextPart(text=str(tr.result.output))],
                tool_call_id=tr.tool_call_id,
            )
            await context.append_message(tool_msg)

    # 5. åˆ¤æ–­æ˜¯å¦é€€å‡ºå¾ªç¯
    if not result.tool_calls:
        break  # æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œä»»åŠ¡å®Œæˆ

    step_no += 1
```

**æ‰§è¡Œç¤ºä¾‹**ï¼š
```
Step 1: ç”¨æˆ·ï¼š"åˆ—å‡ºå½“å‰ç›®å½•çš„ .py æ–‡ä»¶å¹¶è¯»å– setup.py"
        LLM â†’ è°ƒç”¨ Bash("ls *.py")
        Bash æ‰§è¡Œ â†’ è¿”å› "setup.py\ntest.py"

Step 2: LLM æ”¶åˆ° Bash ç»“æœ
        LLM â†’ è°ƒç”¨ ReadFile("setup.py", limit=10)
        ReadFile æ‰§è¡Œ â†’ è¿”å›å‰ 10 è¡Œå†…å®¹

Step 3: LLM æ”¶åˆ° ReadFile ç»“æœ
        LLM â†’ ç”Ÿæˆæ€»ç»“ï¼š"æ‰¾åˆ° 2 ä¸ª .py æ–‡ä»¶ï¼Œsetup.py çš„å‰ 10 è¡Œæ˜¯..."
        æ²¡æœ‰å·¥å…·è°ƒç”¨ â†’ å¾ªç¯é€€å‡º
```

### æ¨¡å¼ 2ï¼šå•æ­¥æ‰§è¡Œï¼ˆä¸æ¨èï¼‰

```python
# åªæ‰§è¡Œä¸€æ­¥ï¼Œä¸å¾ªç¯
result = await kosong.step(...)
tool_results = await result.tool_results()

# é—®é¢˜ï¼šå¦‚æœ LLM éœ€è¦å¤šè½®æ¨ç†ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨å¾ªç¯
```

---

## ğŸ› å¸¸è§é™·é˜±å’Œæ³¨æ„äº‹é¡¹

### é™·é˜± 1ï¼šæœªç­‰å¾… tool_results()

```python
# âŒ é”™è¯¯ï¼šæœªç­‰å¾…å·¥å…·å®Œæˆ
result = await kosong.step(...)
# ç›´æ¥ç»§ç»­ï¼Œå·¥å…·å¯èƒ½è¿˜åœ¨æ‰§è¡Œä¸­ï¼
await context.append_message(result.message)

# âœ… æ­£ç¡®ï¼šç­‰å¾…å·¥å…·å®Œæˆ
result = await kosong.step(...)
tool_results = await result.tool_results()  # â­ ç­‰å¾…
await context.append_message(result.message)
```

### é™·é˜± 2ï¼šToolCall ç»“æ„é”™è¯¯

```python
# âŒ é”™è¯¯ï¼šç›´æ¥è®¿é—® name å’Œ arguments
tool_name = tool_call.name  # AttributeError!

# âœ… æ­£ç¡®ï¼šè®¿é—®åµŒå¥—çš„ function å±æ€§
tool_name = tool_call.function.name
arguments = json.loads(tool_call.function.arguments)
```

### é™·é˜± 3ï¼šå¿˜è®°å¤„ç†å·¥å…·ç»“æœæ¶ˆæ¯

```python
# âŒ é”™è¯¯ï¼šåªæ·»åŠ  LLM æ¶ˆæ¯ï¼Œä¸æ·»åŠ å·¥å…·ç»“æœ
await context.append_message(result.message)
# ä¸‹ä¸€è½® LLM çœ‹ä¸åˆ°å·¥å…·ç»“æœï¼

# âœ… æ­£ç¡®ï¼šæ·»åŠ å·¥å…·ç»“æœåˆ° Context
tool_results = await result.tool_results()
await context.append_message(result.message)
if tool_results:
    for tr in tool_results:
        tool_msg = Message(
            role="tool",
            content=[TextPart(text=str(tr.result.output))],
            tool_call_id=tr.tool_call_id,
        )
        await context.append_message(tool_msg)
```

### é™·é˜± 4ï¼šå¿˜è®° Agent å¾ªç¯é€€å‡ºæ¡ä»¶

```python
# âŒ é”™è¯¯ï¼šæ— é™å¾ªç¯
while True:
    result = await kosong.step(...)
    # æ²¡æœ‰é€€å‡ºæ¡ä»¶ï¼

# âœ… æ­£ç¡®ï¼šæ£€æŸ¥å·¥å…·è°ƒç”¨
while step_no <= MAX_STEPS:
    result = await kosong.step(...)
    if not result.tool_calls:
        break  # â­ æ— å·¥å…·è°ƒç”¨ï¼Œé€€å‡º
    step_no += 1
```

---

## ğŸ“Š å®Œæ•´æ‰§è¡Œæ—¶åºå›¾

```
Time â†’
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Code:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ result = await kosong.step(...)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“

kosong.step():
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tool_calls = []                                                     â”‚
â”‚ tool_result_futures = {}                                            â”‚
â”‚ result = await kosong.generate(                                     â”‚
â”‚     ...,                                                            â”‚
â”‚     on_tool_call=on_tool_call,                                      â”‚
â”‚ )                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“

kosong.generate():
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é€è¯·æ±‚åˆ° LLM API...                                               â”‚
â”‚ å¼€å§‹æµå¼æ¥æ”¶å“åº”...                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TextPart ç‰‡æ®µ â”‚       â”‚ ToolCall ç‰‡æ®µ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ on_message_part â”‚     â”‚ on_tool_call(tool_call)             â”‚
â”‚ â”œâ”€ wire_send    â”‚     â”‚ â”œâ”€ tool_calls.append(tool_call)     â”‚
â”‚ â””â”€ UI æ˜¾ç¤º      â”‚     â”‚ â”œâ”€ result = toolset.handle(...)  â­ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚   â”œâ”€ åˆ›å»º Future                  â”‚
                        â”‚ â”‚   â”œâ”€ create_task(_execute_tool) â”‚
                        â”‚ â”‚   â””â”€ ç«‹å³è¿”å› Future             â”‚
                        â”‚ â””â”€ tool_result_futures[id] = futureâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ asyncio.create_task() å¯åŠ¨åå°ä»»åŠ¡â”‚
                        â”‚ â”œâ”€ è§£æå‚æ•°                    â”‚
                        â”‚ â”œâ”€ è°ƒç”¨å·¥å…·                    â”‚
                        â”‚ â””â”€ future.set_result(...)      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ future_done_callback           â”‚
                        â”‚ â”œâ”€ on_tool_result(ToolResult)  â”‚
                        â”‚ â””â”€ wire_send â†’ UI æ˜¾ç¤º         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ—¶é—´çº¿ï¼š

T0: kosong.step() è°ƒç”¨
T1: kosong.generate() å¼€å§‹
T2: LLM è¿”å›æ–‡æœ¬ç‰‡æ®µ â†’ on_message_part è§¦å‘ â†’ UI æ˜¾ç¤º
T3: LLM è¿”å› ToolCall â†’ on_tool_call è§¦å‘ â†’ toolset.handle()
T4: toolset.handle() å¯åŠ¨åå°ä»»åŠ¡ â†’ ç«‹å³è¿”å› Future
T5: kosong.generate() å®Œæˆ â†’ è¿”å› GenerateResult
T6: kosong.step() è¿”å› StepResultï¼ˆå·¥å…·å¯èƒ½è¿˜åœ¨æ‰§è¡Œï¼ï¼‰
T7: ç”¨æˆ·ä»£ç ï¼šawait result.tool_results() å¼€å§‹ç­‰å¾…
...
Tx: å·¥å…·æ‰§è¡Œå®Œæˆ â†’ future.set_result()
Tx+1: future_done_callback è§¦å‘ â†’ on_tool_result å›è°ƒ â†’ UI æ˜¾ç¤º
Tx+2: result.tool_results() ç­‰å¾…ç»“æŸ â†’ è¿”å› ToolResult åˆ—è¡¨

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**å…³é”®æ—¶é—´ç‚¹**ï¼š
- `T6`ï¼š`kosong.step()` å·²è¿”å›ï¼Œä½†å·¥å…·å¯èƒ½è¿˜åœ¨åå°æ‰§è¡Œ
- `T7-Tx+2`ï¼š`result.tool_results()` é˜»å¡ç­‰å¾…æ‰€æœ‰å·¥å…·å®Œæˆ
- `Tx+1`ï¼šå·¥å…·å®Œæˆæ—¶ï¼Œ`on_tool_result` å›è°ƒç«‹å³è§¦å‘ï¼ˆä¸ç­‰å¾… `tool_results()`ï¼‰

---

## ğŸ“ æ€»ç»“

### kosong.step() çš„æ ¸å¿ƒä»·å€¼

1. **ç®€åŒ– Agent å¾ªç¯**ï¼š
   - è‡ªåŠ¨ç®¡ç†å·¥å…·æ‰§è¡Œï¼ˆåˆ›å»º Futureã€å¯åŠ¨ä»»åŠ¡ã€æ”¶é›†ç»“æœï¼‰
   - å¼€å‘è€…åªéœ€åˆ¤æ–­ `result.tool_calls` æ˜¯å¦ä¸ºç©º

2. **æµå¼å‹å¥½**ï¼š
   - å·¥å…·å¼‚æ­¥æ‰§è¡Œä¸é˜»å¡ LLM æµå¼è¾“å‡º
   - `on_message_part` å’Œ `on_tool_result` å®æ—¶åé¦ˆ

3. **ç±»å‹å®‰å…¨**ï¼š
   - æ˜ç¡®çš„ `StepResult` ç±»å‹
   - å¼ºç±»å‹çš„ `ToolCall` å’Œ `ToolResult`

### è®¾è®¡æ¨¡å¼

1. **Future Patternï¼ˆå¼‚æ­¥æ¨¡å¼ï¼‰**ï¼š
   - Toolset.handle() åŒæ­¥è¿”å› Future
   - å·¥å…·å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»æµç¨‹

2. **Observer Patternï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰**ï¼š
   - `on_message_part`ã€`on_tool_result` å›è°ƒ
   - å®æ—¶äº‹ä»¶é€šçŸ¥

3. **Protocol Patternï¼ˆåè®®æ¨¡å¼ï¼‰**ï¼š
   - Toolset åè®®å®šä¹‰ï¼ˆ`tools` å±æ€§ + `handle` æ–¹æ³•ï¼‰
   - ä¸éœ€è¦ç»§æ‰¿ï¼Œåªéœ€å®ç°æ¥å£

### æœ€ä½³å®è·µ

1. âœ… å§‹ç»ˆä½¿ç”¨ Agent å¾ªç¯æ¨¡å¼
2. âœ… æ£€æŸ¥ `result.tool_calls` ä½œä¸ºé€€å‡ºæ¡ä»¶
3. âœ… ç­‰å¾… `result.tool_results()` åå†ç»§ç»­
4. âœ… å°†å·¥å…·ç»“æœæ·»åŠ åˆ° Context
5. âœ… è®¾ç½®æœ€å¤§æ­¥æ•°é™åˆ¶ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¶é—´**ï¼š2025-01-16
**ä½œè€…**ï¼šè€ç‹ï¼ˆæš´èºæŠ€æœ¯æµï¼‰
**æºç ç‰ˆæœ¬**ï¼škosong-main (commit: unknown)
